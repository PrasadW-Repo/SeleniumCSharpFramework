using Newtonsoft.Json;
using Newtonsoft.Json.Linq;
using System;
using System.Collections.Generic;
using System.IO;
using System.Runtime.InteropServices.JavaScript;
using System.Text;
using System.Text.Json.Nodes;

namespace SeleniumCSharpProject.utilities
{
    public class Utils

    {
        /// <summary>
        /// Reads a JSON file from disk and returns it as a <see cref="JToken"/>.
        /// Works for JSON objects and arrays. Throws an <see cref="InvalidOperationException"/> with context if reading or parsing fails.
        /// </summary>
        /// <param name="fileName">Path to the JSON file.</param>
        /// <returns>Deserialized JSON as <see cref="JToken"/>.</returns>
        public static JToken ReadJSON(String fileName)
        {
            try
            {
                // Read the file contents
                var json = File.ReadAllText(fileName);

                // Parse into a JToken which can represent an object or array
                var token = JToken.Parse(json);

                if (token == null)
                {
                    throw new InvalidOperationException($"The JSON in '{fileName}' could not be parsed into a JToken.");
                }

                return token;
            }
            catch (Exception ex)
            {
                // Wrap and rethrow with additional context to make failures easier to diagnose.
                throw new InvalidOperationException($"Failed to read or parse JSON file '{fileName}'.", ex);
            }
        }
    }
}
